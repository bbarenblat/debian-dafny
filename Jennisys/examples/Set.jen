class Set {
  var elems: set[int]

  constructor Empty()
    ensures elems = {}

  constructor Singleton(t: int)
    ensures elems = {t}

  constructor Sum(p: int, q: int)
    ensures elems = {p + q}

  constructor Double(p: int, q: int)
    requires p != q
    ensures elems = {p q}

  constructor Triple(p: int, q: int, r: int)
    requires p != q && q != r && r != p
    ensures elems = {p q r}
}

model Set {
  var root: SetNode

  frame
    root

  invariant
    root = null ==> elems = {}
    root != null ==> elems = root.elems
}

class SetNode {
  var elems: set[int]

  constructor Init(x: int)
    ensures elems = {x}

  constructor Double(x: int, y: int)
    requires x != y
    ensures elems = {x y}

  constructor DoubleBase(x: int, y: int)
    requires x > y
    ensures elems = {x y}

  constructor Triple(x: int, y: int, z: int)
    requires x != y && y != z && z != x
    ensures elems = {x y z}

  constructor TripleBase(x: int, y: int, z: int)
    requires x < y && y < z
    ensures elems = {x y z}
}

model SetNode {
  var data: int
  var left: SetNode
  var right: SetNode

  frame 
    left * right

  invariant
    elems = {data} + (left != null ? left.elems : {}) + (right != null ? right.elems : {})
    left != null  ==> forall e :: e in left.elems ==> e < data
    right != null ==> forall e :: e in right.elems ==> e > data
} 
